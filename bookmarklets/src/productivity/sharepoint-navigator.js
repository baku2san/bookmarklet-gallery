/**
 * SharePoint Navigator Bookmarklet - „É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞Áâà v5
 * SharePoint „Çµ„Ç§„ÉàÂÜÖ„Åß„ÅÆÁ¥†Êó©„ÅÑ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÇíÊèê‰æõ
 *
 * ÊîπÂñÑÁÇπ:
 * - „É¢„Ç∏„É•„Éº„É´ÂàÜÂâ≤„Å´„Çà„ÇãÂèØË™≠ÊÄßÂêë‰∏ä
 * - Èñ¢Êï∞„ÅÆÂçò‰∏ÄË≤¨‰ªªÂéüÂâá„ÅÆÈÅ©Áî®
 * - ÂÆöÊï∞„ÅÆÂ§ñÈÉ®Âåñ
 * - „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É™„É≥„Ç∞„ÅÆÊúÄÈÅ©Âåñ
 * - ESLint„É´„Éº„É´„Å´Ê∫ñÊã†„Åó„ÅüÊó•Êú¨Ë™û„Ç≥„É°„É≥„Éà
 * - „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÅÆËøΩÂä†
 */

javascript: (function () {
  'use strict';
  // =============================================================================
  // „Ç≥„É≥„ÇΩ„Éº„É´Ë≠¶ÂëäÊäëÂà∂Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
  // =============================================================================
  const SUPPRESS_MUTATION_WARNINGS = true; // ÂøÖË¶Å„Å´Âøú„Åò„Å¶false„Å´Â§âÊõ¥

  if (SUPPRESS_MUTATION_WARNINGS) {
    window.originalConsoleWarn = console.warn;
    console.warn = function (...args) {
      // DOMNodeRemovedÈñ¢ÈÄ£„ÅÆË≠¶Âëä„ÇíÊäëÂà∂
      if (args[0] && typeof args[0] === 'string' &&
        (args[0].includes('DOMNodeRemoved') ||
          args[0].includes('mutation event') ||
          args[0].includes('Mutation Events'))) {
        return;
      }
      window.originalConsoleWarn.apply(console, args);
    };
  }

  // =============================================================================
  // „Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†ÂÆöÊï∞
  // =============================================================================
  const SHAREPOINT_DESIGN_SYSTEM = {
    // „Ç´„É©„Éº„Éë„É¨„ÉÉ„ÉàÔºàMicrosoft Fluent DesignÊ∫ñÊã†Ôºâ
    COLORS: {
      PRIMARY: '#0078d4',           // SharePoint Blue
      PRIMARY_HOVER: '#106ebe',     // Darker blue for hover
      SECONDARY: '#605e5c',         // Text secondary
      SUCCESS: '#107c10',           // Green
      WARNING: '#ff8c00',          // Orange
      DANGER: '#d13438',           // Red

      // ËÉåÊôØËâ≤
      BACKGROUND: {
        PRIMARY: '#ffffff',         // White
        SECONDARY: '#f8f9fa',       // Light gray
        TERTIARY: '#f3f2f1',        // Lighter gray
        PANEL: '#faf9f8'           // Panel background
      },

      // „ÉÜ„Ç≠„Çπ„ÉàËâ≤
      TEXT: {
        PRIMARY: '#323130',         // Dark text
        SECONDARY: '#605e5c',       // Secondary text
        MUTED: '#8a8886',          // Muted text
        INVERSE: '#ffffff'          // White text
      },

      // „Éú„Éº„ÉÄ„ÉºËâ≤
      BORDER: {
        DEFAULT: '#edebe9',         // Default border
        FOCUS: '#0078d4',          // Focus border
        SEPARATOR: '#e1dfdd'        // Separator
      }
    },

    // „Çø„Ç§„Éù„Ç∞„É©„Éï„Ç£
    TYPOGRAPHY: {
      FONT_FAMILY: `-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Segoe UI Web Regular', 'Segoe UI Symbol', 'Helvetica Neue', Arial, sans-serif`,

      SIZES: {
        H1: '20px',
        H2: '18px',
        H3: '16px',
        H4: '14px',
        BODY: '14px',
        CAPTION: '12px',
        SMALL: '11px'
      },

      WEIGHTS: {
        NORMAL: '400',
        MEDIUM: '500',
        SEMIBOLD: '600',
        BOLD: '700'
      },

      LINE_HEIGHTS: {
        TIGHT: '1.2',
        NORMAL: '1.4',
        RELAXED: '1.6'
      }
    },

    // „Çπ„Éö„Éº„Ç∑„É≥„Ç∞
    SPACING: {
      XS: '4px',
      SM: '8px',
      MD: '12px',
      LG: '16px',
      XL: '20px',
      XXL: '24px',
      XXXL: '32px'
    },

    // „Éú„Éº„ÉÄ„ÉºÂçäÂæÑ
    BORDER_RADIUS: {
      SM: '2px',
      MD: '4px',
      LG: '6px',
      XL: '8px',
      ROUND: '50%'
    },

    // „Ç∑„É£„Éâ„Ç¶
    SHADOWS: {
      CARD: '0 1px 3px rgba(0, 0, 0, 0.1)',
      PANEL: '0 4px 8px rgba(0, 0, 0, 0.1)',
      MODAL: '0 8px 16px rgba(0, 0, 0, 0.15)',
      FOCUS: '0 0 0 2px rgba(0, 120, 212, 0.3)'
    },

    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
    TRANSITIONS: {
      FAST: '0.15s ease',
      NORMAL: '0.2s ease',
      SLOW: '0.3s ease'
    },

    // „É¨„Ç§„Ç¢„Ç¶„Éà
    LAYOUT: {
      PANEL_MAX_WIDTH: '800px',
      PANEL_MIN_WIDTH: '320px',
      SIDEBAR_WIDTH: '250px',
      HEADER_HEIGHT: '48px'
    }
  };

  // =============================================================================
  // ÂÆöÊï∞ÂÆöÁæ©
  // =============================================================================
  const CONSTANTS = {
    PANEL_ID: 'shima-sharepoint-navigator',
    MIN_WIDTH: 380,
    MIN_HEIGHT: 300,
    INITIAL_WIDTH: 640,
    INITIAL_HEIGHT: 700,
    MARGIN: 20,
    Z_INDEX: 2147483647,

    PRIORITIES: {
      HIGH: 'high',
      MEDIUM: 'medium',
      LOW: 'low',
      ALL: 'all'
    },

    PRIORITY_COLORS: {
      all: SHAREPOINT_DESIGN_SYSTEM.COLORS.PRIMARY,
      high: SHAREPOINT_DESIGN_SYSTEM.COLORS.DANGER,
      medium: SHAREPOINT_DESIGN_SYSTEM.COLORS.WARNING,
      low: SHAREPOINT_DESIGN_SYSTEM.COLORS.SUCCESS
    },

    ICONS: {
      NAVIGATOR: 'üß≠',
      STAR: '‚≠ê',
      USERS: 'üë•',
      GALLERY: 'üèõÔ∏è',
      ADMIN: 'üèóÔ∏è',
      DESIGN: 'üé®',
      ACTION: '‚ö°',
      COLLECTION: 'üèõÔ∏è',
      TOOLS: 'üîß',
      MAINTENANCE: 'üîß'
    }
  };

  // =============================================================================
  // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
  // =============================================================================
  const Utils = {
    // ========== ÂÖ±ÈÄö„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞ ==========

    // HTML „Ç®„Çπ„Ç±„Éº„Éó
    escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    },

    // „Éç„Çπ„Éà„Åó„ÅüÂÄ§„ÇíÂèñÂæó
    getNestedValue(obj, path) {
      return path.split('.').reduce((current, key) => {
        return current && current[key] !== undefined ? current[key] : '';
      }, obj);
    },

    // ÂÄ§„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà
    formatValue(value, field) {
      if (value === null || value === undefined) {
        return '<em style="color: #999 !important;">null</em>';
      }
      if (typeof value === 'boolean') {
        return value ? '‚úì' : '‚úó';
      }
      if (typeof value === 'object') {
        return '<em style="color: #666 !important;">[Object]</em>';
      }
      if (field && field.toLowerCase().includes('date') && value) {
        try {
          return new Date(value).toLocaleString('ja-JP');
        } catch (e) {
          return this.escapeHtml(String(value));
        }
      }
      return this.escapeHtml(String(value));
    },

    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å∏„ÅÆ‰øùÂ≠ò
    saveToStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
      } catch (e) {
        console.warn('„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å∏„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:', e);
        return false;
      }
    },

    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„ÅÆË™≠„ÅøËæº„Åø
    loadFromStorage(key, defaultValue = null) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
      } catch (e) {
        console.warn('„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', e);
        return defaultValue;
      }
    },

    // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÁî®„ÅÆÂÆâÂÖ®„Å™„Ç®„Çπ„Ç±„Éº„Éó
    escapeForClipboard(value) {
      if (value === null || value === undefined) {
        return '';
      }

      const str = String(value);
      // JavaScript„ÅÆÊñáÂ≠óÂàó„É™„ÉÜ„É©„É´Áî®„ÅÆ„Ç®„Çπ„Ç±„Éº„Éó
      return str.replace(/\\/g, '\\\\')
        .replace(/'/g, "\\'")
        .replace(/"/g, '\\"')
        .replace(/\n/g, '\\n')
        .replace(/\r/g, '\\r')
        .replace(/\t/g, '\\t');
    },

    // ‰∏ÄÊôÇ„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    showTemporaryMessage(message, type = 'success', duration = 3000) {
      // Êó¢Â≠ò„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
      const existingMessage = document.getElementById('shima-temp-message');
      if (existingMessage) {
        existingMessage.remove();
      }

      // „É°„ÉÉ„Çª„Éº„Ç∏Ë¶ÅÁ¥†„Çí‰ΩúÊàê
      const messageDiv = document.createElement('div');
      messageDiv.id = 'shima-temp-message';

      const bgColor = type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#fff3cd';
      const borderColor = type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#ffeaa7';
      const textColor = type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#856404';

      messageDiv.style.cssText = `
        position: fixed !important;
        top: 80px !important;
        right: 20px !important;
        background: ${bgColor} !important;
        border: 1px solid ${borderColor} !important;
        border-radius: 6px !important;
        padding: 12px 16px !important;
        color: ${textColor} !important;
        font-family: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.FONT_FAMILY} !important;
        font-size: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.SIZES.SMALL} !important;
        font-weight: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.WEIGHTS.MEDIUM} !important;
        box-shadow: ${SHAREPOINT_DESIGN_SYSTEM.SHADOWS.CARD} !important;
        z-index: 2147483647 !important;
        max-width: 400px !important;
        word-wrap: break-word !important;
        animation: shimaCopyMessageSlideIn 0.3s ease-out !important;
        cursor: pointer !important;
      `;

      messageDiv.innerHTML = message;

      // „ÇØ„É™„ÉÉ„ÇØ„ÅßÂâäÈô§
      messageDiv.addEventListener('click', () => {
        messageDiv.remove();
      });

      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥CSS„ÇíËøΩÂä†Ôºà‰∏ÄÂ∫¶„Å†„ÅëÔºâ
      if (!document.getElementById('shima-copy-animation-styles')) {
        const style = document.createElement('style');
        style.id = 'shima-copy-animation-styles';
        style.textContent = `
          @keyframes shimaCopyMessageSlideIn {
            from {
              transform: translateX(100%) !important;
              opacity: 0 !important;
            }
            to {
              transform: translateX(0) !important;
              opacity: 1 !important;
            }
          }
          @keyframes shimaCopyMessageSlideOut {
            from {
              transform: translateX(0) !important;
              opacity: 1 !important;
            }
            to {
              transform: translateX(100%) !important;
              opacity: 0 !important;
            }
          }
        `;
        document.head.appendChild(style);
      }

      document.body.appendChild(messageDiv);

      // ÊåáÂÆöÊôÇÈñìÂæå„Å´ÂâäÈô§
      setTimeout(() => {
        if (messageDiv.parentNode) {
          messageDiv.style.animation = 'shimaCopyMessageSlideOut 0.3s ease-in';
          setTimeout(() => {
            if (messageDiv.parentNode) {
              messageDiv.remove();
            }
          }, 300);
        }
      }, duration);
    },

    // ========== NavigatorÂõ∫Êúâ„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞ ==========

    /**
     * Êó¢Â≠ò„ÅÆ„Éë„Éç„É´„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
     * @returns {boolean} „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„ÅåÂÆüË°å„Åï„Çå„Åü„Åã„Å©„ÅÜ„Åã
     */
    cleanupExistingPanel: function () {
      const existingPanel = document.getElementById(CONSTANTS.PANEL_ID);
      if (existingPanel) {
        // „Éë„Éç„É´ÂÜÖ„ÅÆÂÖ®„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        const allElements = existingPanel.querySelectorAll('*');
        allElements.forEach(element => {
          // cloneNode„Åß„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂÆåÂÖ®„Å´ÂâäÈô§
          const newElement = element.cloneNode(true);
          if (element.parentNode) {
            element.parentNode.replaceChild(newElement, element);
          }
        });

        // „Éë„Éç„É´Ëá™‰Ωì„ÇíÂâäÈô§
        existingPanel.remove();

        // Ê≥®ÂÖ•„Åó„ÅüCSS„ÇíÂâäÈô§
        const styleElement = document.getElementById('shima-navigator-styles');
        if (styleElement) {
          styleElement.remove();
        }

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        this.cleanupGlobalFunctions();
        return true;
      }
      return false;
    },

    /**
     * „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
     */
    cleanupGlobalFunctions: function () {
      const functionNames = [
        'shimaNavUpdateTextFilter',
        'shimaNavUpdatePriorityFilter',
        'shimaNavClearFilters',
        'shimaNavToggleCategory',
        'shimaNavClosePanel'
      ];

      functionNames.forEach(name => {
        if (window[name]) {
          delete window[name];
        }
      });
    },    /**
     * SharePoint„Çµ„Ç§„ÉàÊÉÖÂ†±„ÇíÂèñÂæó
     * @returns {Object|null} „Çµ„Ç§„ÉàÊÉÖÂ†±„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÄÅ„Åæ„Åü„ÅØnullÔºàSharePoint„Çµ„Ç§„Éà„Åß„Å™„ÅÑÂ†¥ÂêàÔºâ
     */
    getSharePointSiteInfo: function () {
      const currentUrl = window.location.href;

      // URL„Åã„Çâ„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„Å®„Éè„ÉÉ„Ç∑„É•„ÇíÈô§Âéª„Åó„Å¶„Éô„Éº„ÇπURL„ÇíÂèñÂæó
      const cleanUrl = currentUrl.split('?')[0].split('#')[0];
      const sharepointMatch = cleanUrl.match(/^(?<domain>https?:\/\/[^\/]+)\/sites\/(?<siteName>[^\/]+)/);

      if (!sharepointMatch) {
        return null;
      }

      const { domain, siteName } = sharepointMatch.groups;
      let baseUrl = domain + '/sites/' + siteName;      // TopSite „Åã ChildSite „Åã„ÇíÂà§Âà•
      const childSiteMatch = cleanUrl.match(/^(?<protocol>https?:\/\/[^\/]+)\/sites\/(?<siteName>[^\/]+)\/(?<thirdLevelPath>[^\/]+)/);

      // SharePoint„ÅÆÁâπÊÆä„Éë„ÇπÔºà„Ç∑„Çπ„ÉÜ„É†„Éá„Ç£„É¨„ÇØ„Éà„É™Ôºâ„ÇíÂÆöÁæ©
      const systemPaths = [
        'pages', 'lists', 'shared%20documents', 'shared documents', 'forms', 'sitepages',
        'style%20library', 'style library', 'site%20assets', 'site assets', 'siteassets',
      ];

      const thirdLevelPath = childSiteMatch?.groups?.thirdLevelPath || '';

      // „Ç∑„Çπ„ÉÜ„É†„Éë„ÇπÔºàSharePoint„ÅÆÁâπÊÆä„Éá„Ç£„É¨„ÇØ„Éà„É™Ôºâ„Åã„Å©„ÅÜ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      const isSystemPath = thirdLevelPath && (
        systemPaths.includes(thirdLevelPath.toLowerCase()) ||
        systemPaths.includes(decodeURIComponent(thirdLevelPath).toLowerCase()) ||
        thirdLevelPath.startsWith('_') // _layouts, _catalogs, _api, _vti_, etc.
      );

      // ÂÆüÈöõ„ÅÆÂ≠ê„Çµ„Ç§„Éà„Åã„Å©„ÅÜ„Åã„ÇíÂà§Âà•Ôºà„Ç∑„Çπ„ÉÜ„É†„Éë„Çπ„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
      const isChildSite = childSiteMatch && thirdLevelPath && !isSystemPath;

      let childSiteName = '';
      if (isChildSite) {
        childSiteName = thirdLevelPath;
        baseUrl = domain + '/sites/' + siteName + '/' + childSiteName;
      }

      // „É°„É≥„ÉÜ„Éä„É≥„Çπ„É¢„Éº„Éâ„Å™„Å©„ÅÆÁâπÊÆäURL„ÇíÊ§úÂá∫
      const isSpecialUrl = currentUrl.includes('maintenancemode=true') ||
        currentUrl.includes('_vti_pvt') ||
        currentUrl.includes('Contents=1');

      return {
        domain,
        siteName,
        childSiteName,
        baseUrl,
        isChildSite,
        isSpecialUrl,
        displayName: isChildSite ? `${siteName}/${childSiteName}` : siteName,
        siteType: isChildSite ? 'Child Site' : 'Top Site'
      };
    },

    /**
     * ÂàùÊúü„Éë„Éç„É´„Çµ„Ç§„Ç∫„Å®‰ΩçÁΩÆ„ÇíË®àÁÆó
     * @returns {Object} ‰ΩçÁΩÆ„Å®„Çµ„Ç§„Ç∫„ÅÆÊÉÖÂ†±
     */
    calculateInitialDimensions: function () {
      let width = Math.min(CONSTANTS.INITIAL_WIDTH, window.innerWidth - 40);
      let height = Math.min(CONSTANTS.INITIAL_HEIGHT, window.innerHeight - 40);
      let left = CONSTANTS.MARGIN;
      let top = CONSTANTS.MARGIN;

      // ÁîªÈù¢„Çµ„Ç§„Ç∫„ÅåÂ∞è„Åï„ÅÑÂ†¥Âêà„ÅÆË™øÊï¥
      if (window.innerWidth < 520) {
        width = window.innerWidth - CONSTANTS.MARGIN;
        left = 10;
      }
      if (window.innerHeight < 600) {
        height = window.innerHeight - 60;
        top = 30;
      }

      return { width, height, left, top };
    }
  };

  // =============================================================================
  // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éá„Éº„ÇøÁîüÊàê
  // =============================================================================
  const NavigationData = {
    /**
     * „Åô„Åπ„Å¶„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éá„Éº„Çø„ÇíÁîüÊàê
     * @param {Object} siteInfo „Çµ„Ç§„ÉàÊÉÖÂ†±
     * @returns {Array} „Ç´„ÉÜ„Ç¥„É™ÈÖçÂàó
     */
    createCategories: function (siteInfo) {
      return [
        this.createFrequentCategory(siteInfo),
        this.createUserPermissionCategory(siteInfo),
        this.createGalleryCategory(siteInfo),
        this.createSiteAdminCategory(siteInfo),
        this.createLookFeelCategory(siteInfo),
        this.createSiteActionCategory(siteInfo),
        this.createSiteCollectionCategory(siteInfo),
        this.createCommonActionCategory(siteInfo),
        this.createMaintenanceCategory(siteInfo)
      ];
    },

    /**
     * „Çà„Åè‰Ωø„ÅÜÊ©üËÉΩ„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createFrequentCategory: function (siteInfo) {
      const links = [
        {
          title: '„Çµ„Ç§„Éà„Ç≥„É≥„ÉÜ„É≥„ÉÑ',
          url: `${siteInfo.baseUrl}/_layouts/15/viewlsts.aspx`,
          icon: 'üìã',
          description: '„Çµ„Ç§„ÉàÂÜÖ„ÅÆ„É™„Çπ„Éà„Å®„É©„Ç§„Éñ„É©„É™‰∏ÄË¶ß',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éê„ÉºÈùûË°®Á§∫',
          url: `${siteInfo.baseUrl}?env=WebView`,
          icon: 'üëÅÔ∏è',
          description: '„Éä„Éì„ÄÅ„Éò„ÉÉ„ÉÄ„Éº„ÄÅ„Ç≥„Éû„É≥„Éâ„Éê„Éº„ÇíÈùûË°®Á§∫',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„Éä„Éì&„Éò„ÉÉ„ÉÄ„ÉºÈùûË°®Á§∫',
          url: `${siteInfo.baseUrl}?env=Embedded`,
          icon: 'üñºÔ∏è',
          description: '„Éä„Éì„Å®„Éò„ÉÉ„ÉÄ„Éº„ÇíÈùûË°®Á§∫',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: 'Microsoft Lists„ÅßÈñã„Åè',
          url: `${siteInfo.baseUrl}?env=WebViewList`,
          icon: 'üìÑ',
          description: '„É™„Çπ„Éà/„É©„Ç§„Éñ„É©„É™„ÇíMicrosoft Lists„Ç¢„Éó„É™„ÅßÈñã„Åè',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„Çµ„Ç§„ÉàË®≠ÂÆö',
          url: `${siteInfo.baseUrl}/_layouts/15/settings.aspx`,
          icon: '‚öôÔ∏è',
          description: '„Çµ„Ç§„ÉàË®≠ÂÆö„Éö„Éº„Ç∏',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: 'ÂÖ±Êúâ„Éï„Ç©„É´„ÉÄ',
          url: `${siteInfo.baseUrl}/Shared%20Documents/Forms/AllItems.aspx?view=3`,
          icon: 'ü§ù',
          description: 'ÂÖ±Êúâ„Åï„Çå„Åü„Éâ„Ç≠„É•„É°„É≥„Éà',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„ÇØ„É©„Ç∑„ÉÉ„ÇØ„Ç¢„Éó„É™„Çπ„Éà„Ç¢',
          url: `${siteInfo.baseUrl}/_layouts/15/addanapp.aspx`,
          icon: 'üè™',
          description: 'SharePoint„Ç¢„Éó„É™„ÅÆËøΩÂä†',
          priority: CONSTANTS.PRIORITIES.HIGH
        }
      ];

      // Â≠ê„Çµ„Ç§„Éà„ÅÆÂ†¥Âêà„ÅØË¶™„Çµ„Ç§„Éà„Å∏„ÅÆ„É™„É≥„ÇØ„ÇíËøΩÂä†
      if (siteInfo.isChildSite) {
        const topSiteUrl = `${siteInfo.domain}/sites/${siteInfo.siteName}`;
        links.unshift({
          title: 'Top Site „Å´ÁßªÂãï',
          url: topSiteUrl,
          icon: '‚¨ÜÔ∏è',
          description: 'Ë¶™„Çµ„Ç§„Éà„Å´ÁßªÂãï',
          priority: CONSTANTS.PRIORITIES.HIGH
        });
      }

      return {
        name: '„Çà„Åè‰Ωø„ÅÜÊ©üËÉΩ',
        icon: CONSTANTS.ICONS.STAR,
        links: links,
        collapsed: false
      };
    },

    /**
     * „É¶„Éº„Ç∂„Éº„Å®Ê®©Èôê„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createUserPermissionCategory: function (siteInfo) {
      return {
        name: '„É¶„Éº„Ç∂„Éº„Å®Ê®©Èôê',
        icon: CONSTANTS.ICONS.USERS,
        links: [
          {
            title: '„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ',
            url: `${siteInfo.baseUrl}/_layouts/people.aspx`,
            icon: 'üë•',
            description: '„Çµ„Ç§„Éà„É¶„Éº„Ç∂„Éº„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Ç∞„É´„Éº„ÉóÁÆ°ÁêÜ',
            url: `${siteInfo.baseUrl}/_layouts/groups.aspx`,
            icon: 'üë´',
            description: 'SharePoint„Ç∞„É´„Éº„Éó„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥ÁÆ°ÁêÜËÄÖ',
            url: `${siteInfo.baseUrl}/_layouts/mngsiteadmin.aspx`,
            icon: 'üëë',
            description: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥ÁÆ°ÁêÜËÄÖ„ÅÆË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'Ë©≥Á¥∞Ê®©ÈôêË®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/user.aspx`,
            icon: 'üîê',
            description: 'Ë©≥Á¥∞„Å™„Ç¢„ÇØ„Çª„ÇπË®±ÂèØË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Ç¢„Éó„É™Ê®©Èôê',
            url: `${siteInfo.baseUrl}/_layouts/15/AppPrincipals.aspx`,
            icon: 'üîë',
            description: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Ç¢„Éó„É™„ÅÆÊ®©Èôê',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          }
        ],
        collapsed: false
      };
    },

    /**
     * „ÇÆ„É£„É©„É™„Éº„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createGalleryCategory: function (siteInfo) {
      return {
        name: '„ÇÆ„É£„É©„É™„Éº',
        icon: CONSTANTS.ICONS.GALLERY,
        links: [
          {
            title: '„Çµ„Ç§„ÉàÂàó',
            url: `${siteInfo.baseUrl}/_layouts/mngfield.aspx`,
            icon: 'üìä',
            description: '„Çµ„Ç§„ÉàÂàó„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„Çµ„Ç§„Éà„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çø„Ç§„Éó',
            url: `${siteInfo.baseUrl}/_layouts/mngctype.aspx`,
            icon: 'üìÇ',
            description: '„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çø„Ç§„Éó„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: 'Web„Éë„Éº„ÉÑ',
            url: `${siteInfo.baseUrl}/_catalogs/wp/Forms/AllItems.aspx`,
            icon: 'üß©',
            description: 'Web„Éë„Éº„ÉÑ„ÇÆ„É£„É©„É™„Éº',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„É™„Çπ„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà',
            url: `${siteInfo.baseUrl}/_catalogs/lt/Forms/AllItems.aspx`,
            icon: 'üìù',
            description: '„É™„Çπ„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇÆ„É£„É©„É™„Éº',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„Éû„Çπ„Çø„Éº„Éö„Éº„Ç∏',
            url: `${siteInfo.baseUrl}/_layouts/ChangeSiteMasterPage.aspx`,
            icon: 'üé®',
            description: '„Éû„Çπ„Çø„Éº„Éö„Éº„Ç∏„ÅÆÂ§âÊõ¥',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„ÉÜ„Éº„Éû',
            url: `${siteInfo.baseUrl}/_catalogs/theme/Forms/AllItems.aspx`,
            icon: 'üé®',
            description: '„ÉÜ„Éº„Éû„ÇÆ„É£„É©„É™„Éº',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„ÇΩ„É™„É•„Éº„Ç∑„Éß„É≥',
            url: `${siteInfo.baseUrl}/_catalogs/solutions/Forms/AllItems.aspx`,
            icon: 'üì¶',
            description: '„ÇΩ„É™„É•„Éº„Ç∑„Éß„É≥„ÇÆ„É£„É©„É™„Éº',
            priority: CONSTANTS.PRIORITIES.LOW
          }
        ],
        collapsed: false
      };
    },

    /**
     * „Çµ„Ç§„ÉàÁÆ°ÁêÜ„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createSiteAdminCategory: function (siteInfo) {
      return {
        name: '„Çµ„Ç§„ÉàÁÆ°ÁêÜ',
        icon: CONSTANTS.ICONS.ADMIN,
        links: [
          {
            title: 'Âú∞ÂüüË®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/regionalsetng.aspx`,
            icon: 'üåç',
            description: '„Çø„Ç§„É†„Çæ„Éº„É≥„Å®Âú∞ÂüüË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å®ÊßãÈÄ†',
            url: `${siteInfo.baseUrl}/_Layouts/sitemanager.aspx`,
            icon: 'üèóÔ∏è',
            description: '„Çµ„Ç§„ÉàÊßãÈÄ†„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çµ„Ç§„Éà„É©„Ç§„Éñ„É©„É™„Å®„É™„Çπ„Éà',
            url: `${siteInfo.baseUrl}/_layouts/mcontent.aspx`,
            icon: 'üìö',
            description: '„Åô„Åπ„Å¶„ÅÆ„É™„Çπ„Éà„Å®„É©„Ç§„Éñ„É©„É™',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„É¶„Éº„Ç∂„Éº„Ç¢„É©„Éº„Éà',
            url: `${siteInfo.baseUrl}/_layouts/sitesubs.aspx`,
            icon: 'üîî',
            description: '„Ç¢„É©„Éº„ÉàË®≠ÂÆö„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'RSSË®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/siterss.aspx`,
            icon: 'üì°',
            description: 'RSSÈÖç‰ø°Ë®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çµ„Ç§„Éà„Å®„ÉØ„Éº„ÇØ„Çπ„Éö„Éº„Çπ',
            url: `${siteInfo.baseUrl}/_layouts/mngsubwebs.aspx`,
            icon: 'üè¢',
            description: '„Çµ„Éñ„Çµ„Ç§„Éà„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„ÉØ„Éº„ÇØ„Éï„É≠„Éº',
            url: `${siteInfo.baseUrl}/_layouts/wrkmng.aspx`,
            icon: 'üîÑ',
            description: '„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅÆÁÆ°ÁêÜ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çø„ÇØ„ÇΩ„Éé„Éü„ÉºÈö†„Åó„É™„Çπ„Éà',
            url: `${siteInfo.baseUrl}/Lists/TaxonomyHiddenList`,
            icon: 'üè∑Ô∏è',
            description: '„Çø„ÇØ„ÇΩ„Éé„Éü„ÉºÁÆ°ÁêÜÁî®Èö†„Åó„É™„Çπ„Éà',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          }
        ],
        collapsed: false
      };
    },

    /**
     * Â§ñË¶≥„Å®„Éá„Ç∂„Ç§„É≥„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createLookFeelCategory: function (siteInfo) {
      return {
        name: 'Â§ñË¶≥„Å®„Éá„Ç∂„Ç§„É≥',
        icon: CONSTANTS.ICONS.DESIGN,
        links: [
          {
            title: '„Ç¶„Çß„É´„Ç´„É†„Éö„Éº„Ç∏',
            url: `${siteInfo.baseUrl}/_Layouts/AreaWelcomePage.aspx`,
            icon: 'üëã',
            description: '„Ç¶„Çß„É´„Ç´„É†„Éö„Éº„Ç∏„ÅÆË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„Çø„Ç§„Éà„É´„ÄÅË™¨Êòé„ÄÅ„Ç¢„Ç§„Ç≥„É≥',
            url: `${siteInfo.baseUrl}/_layouts/prjsetng.aspx`,
            icon: 'üì∞',
            description: '„Çµ„Ç§„Éà„ÅÆÂü∫Êú¨ÊÉÖÂ†±Ë®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„Éö„Éº„Ç∏„É¨„Ç§„Ç¢„Ç¶„Éà',
            url: `${siteInfo.baseUrl}/_Layouts/ChangeSiteMasterPage.aspx`,
            icon: 'üìÑ',
            description: '„Éö„Éº„Ç∏„É¨„Ç§„Ç¢„Ç¶„Éà„ÅÆÂ§âÊõ¥',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„ÉÑ„É™„Éº„Éì„É•„Éº',
            url: `${siteInfo.baseUrl}/_layouts/navoptions.aspx`,
            icon: 'üå≥',
            description: '„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÉÑ„É™„Éº„ÅÆË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„Çµ„Ç§„Éà„ÉÜ„Éº„Éû',
            url: `${siteInfo.baseUrl}/_layouts/themeweb.aspx`,
            icon: 'üé®',
            description: '„Çµ„Ç§„Éà„ÉÜ„Éº„Éû„ÅÆÂ§âÊõ¥',
            priority: CONSTANTS.PRIORITIES.LOW
          },
          {
            title: '„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ë®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/AreaNavigationSettings.aspx`,
            icon: 'üß≠',
            description: '„Çµ„Ç§„Éà„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.LOW
          }
        ],
        collapsed: false
      };
    },

    /**
     * „Çµ„Ç§„Éà„Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createSiteActionCategory: function (siteInfo) {
      return {
        name: '„Çµ„Ç§„Éà„Ç¢„ÇØ„Ç∑„Éß„É≥',
        icon: CONSTANTS.ICONS.ACTION,
        links: [
          {
            title: '„Çµ„Ç§„ÉàÊ©üËÉΩÁÆ°ÁêÜ',
            url: `${siteInfo.baseUrl}/_layouts/ManageFeatures.aspx`,
            icon: 'üîß',
            description: '„Çµ„Ç§„ÉàÊ©üËÉΩ„ÅÆÊúâÂäπ/ÁÑ°Âäπ',
            priority: CONSTANTS.PRIORITIES.HIGH
          },
          {
            title: '„Çµ„Ç§„ÉàÂâäÈô§',
            url: `${siteInfo.baseUrl}/_layouts/deleteweb.aspx`,
            icon: 'üóëÔ∏è',
            description: '„Åì„ÅÆ„Çµ„Ç§„Éà„ÇíÂâäÈô§',
            priority: CONSTANTS.PRIORITIES.HIGH
          },
          {
            title: '„Çµ„Ç§„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà‰øùÂ≠ò',
            url: `${siteInfo.baseUrl}/_layouts/savetmpl.aspx`,
            icon: 'üíæ',
            description: '„Çµ„Ç§„Éà„Çí„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å®„Åó„Å¶‰øùÂ≠ò',
            priority: CONSTANTS.PRIORITIES.HIGH
          },
          {
            title: '„Åî„ÅøÁÆ±',
            url: `${siteInfo.baseUrl}/_layouts/RecycleBin.aspx`,
            icon: 'üóëÔ∏è',
            description: '„Çµ„Ç§„Éà„É¨„Éô„É´„ÅÆ„Åî„ÅøÁÆ±',
            priority: CONSTANTS.PRIORITIES.HIGH
          }
        ],
        collapsed: false
      };
    },

    /**
     * „Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥ÁÆ°ÁêÜ„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createSiteCollectionCategory: function (siteInfo) {
      return {
        name: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥ÁÆ°ÁêÜ',
        icon: CONSTANTS.ICONS.COLLECTION,
        links: [
          {
            title: 'Ê§úÁ¥¢Ë®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/enhancedSearch.aspx`,
            icon: 'üîç',
            description: 'Ê§úÁ¥¢„ÅÆË©≥Á¥∞Ë®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥Ê©üËÉΩ',
            url: `${siteInfo.baseUrl}/_layouts/ManageFeatures.aspx?Scope=Site`,
            icon: 'üîß',
            description: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„É¨„Éô„É´„ÅÆÊ©üËÉΩ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çµ„Ç§„ÉàÈöéÂ±§',
            url: `${siteInfo.baseUrl}/_layouts/vsubwebs.aspx`,
            icon: 'üå≥',
            description: '„Çµ„Ç§„ÉàÈöéÂ±§„ÅÆË°®Á§∫',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'Áõ£ÊüªË®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/AuditSettings.aspx`,
            icon: 'üìä',
            description: '„Çµ„Ç§„Éà„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥Áõ£ÊüªË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'Áõ£Êüª„É≠„Ç∞„É¨„Éù„Éº„Éà',
            url: `${siteInfo.baseUrl}/_layouts/Reporting.aspx?Category=Auditing`,
            icon: 'üìà',
            description: 'Áõ£Êüª„É≠„Ç∞„ÅÆË°®Á§∫',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: '„Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Áä∂Ê≥Å',
            url: `${siteInfo.baseUrl}/_layouts/storman.aspx`,
            icon: 'üíΩ',
            description: '„Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè„ÅÆÁ¢∫Ë™ç',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'SharePoint DesignerË®≠ÂÆö',
            url: `${siteInfo.baseUrl}/_layouts/SharePointDesignerSettings.aspx`,
            icon: 'üé®',
            description: 'SharePoint Designer„ÅÆË®≠ÂÆö',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          }
        ],
        collapsed: false
      };
    },

    /**
     * ‰∏ÄËà¨ÁöÑ„Å™„Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createCommonActionCategory: function (siteInfo) {
      const links = [
        {
          title: 'Êñ∞Ë¶è‰ΩúÊàê',
          url: `${siteInfo.baseUrl}/_layouts/spscreate.aspx`,
          icon: '‚ûï',
          description: 'Êñ∞„Åó„ÅÑ„Ç¢„Ç§„ÉÜ„É†„ÅÆ‰ΩúÊàê',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„É™„Çπ„ÉàË°®Á§∫',
          url: `${siteInfo.baseUrl}/_layouts/viewlsts.aspx`,
          icon: 'üìã',
          description: 'ÂÖ®„É™„Çπ„Éà„ÅÆË°®Á§∫',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„Çµ„Ç§„Éà„Ç∞„É´„Éº„Éó‰ΩúÊàê',
          url: `${siteInfo.baseUrl}/_layouts/permsetup.aspx`,
          icon: 'üë•',
          description: '„Çµ„Ç§„Éà„Ç∞„É´„Éº„Éó„ÅÆ‰ΩúÊàê',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„ÇØ„Ç§„ÉÉ„ÇØËµ∑Âãï',
          url: `${siteInfo.baseUrl}/_layouts/quiklnch.aspx`,
          icon: 'üöÄ',
          description: '„ÇØ„Ç§„ÉÉ„ÇØËµ∑Âãï„ÅÆË®≠ÂÆö',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂ±•Ê≠¥',
          url: `${siteInfo.baseUrl}/lists/Workflow History`,
          icon: 'üìú',
          description: '„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂ±•Ê≠¥„É™„Çπ„Éà',
          priority: CONSTANTS.PRIORITIES.HIGH
        },
        {
          title: '„É¶„Éº„Ç∂„Éº„Ç¢„É©„Éº„ÉàÁÆ°ÁêÜ',
          url: `${siteInfo.baseUrl}/_layouts/AlertsAdmin.aspx`,
          icon: 'üîî',
          description: '„É¶„Éº„Ç∂„Éº„Ç¢„É©„Éº„Éà„ÅÆÁÆ°ÁêÜ',
          priority: CONSTANTS.PRIORITIES.HIGH
        }
      ];

      // ÁâπÊÆäURLÁî®„ÅÆ„É™„É≥„ÇØ„ÇíËøΩÂä†
      if (siteInfo.isSpecialUrl) {
        links.unshift({
          title: 'ÈÄöÂ∏∏„É¢„Éº„Éâ„Å´Êàª„Çã',
          url: siteInfo.baseUrl,
          icon: 'üîÑ',
          description: 'ÈÄöÂ∏∏„ÅÆ„Éö„Éº„Ç∏„Éì„É•„Éº„Å´Êàª„Çã',
          priority: CONSTANTS.PRIORITIES.HIGH
        });
      }

      return {
        name: '‰∏ÄËà¨ÁöÑ„Å™„Ç¢„ÇØ„Ç∑„Éß„É≥',
        icon: CONSTANTS.ICONS.TOOLS,
        links: links,
        collapsed: false
      };
    },

    /**
     * „É°„É≥„ÉÜ„Éä„É≥„Çπ„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
     */
    createMaintenanceCategory: function (siteInfo) {
      return {
        name: '„É°„É≥„ÉÜ„Éä„É≥„Çπ',
        icon: CONSTANTS.ICONS.MAINTENANCE,
        links: [
          {
            title: 'Web„Éë„Éº„ÉÑ„É°„É≥„ÉÜ„Éä„É≥„ÇπÔºà„ÇØ„É©„Ç∑„ÉÉ„ÇØÔºâ',
            url: `${siteInfo.baseUrl}?Contents=1`,
            icon: 'üîß',
            description: '„ÇØ„É©„Ç∑„ÉÉ„ÇØ„Éö„Éº„Ç∏„ÅÆWeb„Éë„Éº„ÉÑ„É°„É≥„ÉÜ„Éä„É≥„Çπ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'Web„Éë„Éº„ÉÑ„É°„É≥„ÉÜ„Éä„É≥„ÇπÔºà„É¢„ÉÄ„É≥Ôºâ',
            url: `${siteInfo.baseUrl}?maintenancemode=true`,
            icon: 'üîß',
            description: '„É¢„ÉÄ„É≥„Éö„Éº„Ç∏„ÅÆ„É°„É≥„ÉÜ„Éä„É≥„Çπ„É¢„Éº„Éâ',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          },
          {
            title: 'SharePoint„Éê„Éº„Ç∏„Éß„É≥Á¢∫Ë™ç',
            url: `${siteInfo.baseUrl}/_vti_pvt/Service.cnf`,
            icon: '‚ÑπÔ∏è',
            description: '„Çµ„Éº„Éê„Éº„Éê„Éº„Ç∏„Éß„É≥„Å®„Éë„ÉÉ„ÉÅ„É¨„Éô„É´',
            priority: CONSTANTS.PRIORITIES.MEDIUM
          }
        ],
        collapsed: false
      };
    }
  };

  // =============================================================================
  // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞
  // =============================================================================
  const FilterManager = {
    currentPriorityFilter: CONSTANTS.PRIORITIES.ALL,
    currentTextFilter: '',

    /**
     * „Éï„Ç£„É´„Çø„Éº„ÇíÈÅ©Áî®„Åó„Å¶„Ç´„ÉÜ„Ç¥„É™„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
     * @param {Array} categories ÂÖ®„Ç´„ÉÜ„Ç¥„É™
     * @returns {Array} „Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ê∏à„Åø„Ç´„ÉÜ„Ç¥„É™
     */
    applyFilters: function (categories) {
      const self = this;
      return categories.map(function (category) {
        const filteredLinks = category.links.filter(function (link) {
          // ÂÑ™ÂÖàÂ∫¶„Éï„Ç£„É´„Çø„Éº
          const priorityMatch = self.currentPriorityFilter === CONSTANTS.PRIORITIES.ALL ||
            link.priority === self.currentPriorityFilter;

          // „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„É´„Çø„Éº
          const textMatch = self.currentTextFilter === '' ||
            link.title.toLowerCase().includes(self.currentTextFilter.toLowerCase()) ||
            link.description.toLowerCase().includes(self.currentTextFilter.toLowerCase());

          return priorityMatch && textMatch;
        });

        return {
          name: category.name,
          icon: category.icon,
          links: filteredLinks,
          collapsed: category.collapsed
        };
      }).filter(function (category) {
        return category.links.length > 0;
      });
    },

    /**
     * „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„É´„Çø„Éº„ÇíÊõ¥Êñ∞
     * @param {string} value „Éï„Ç£„É´„Çø„ÉºÊñáÂ≠óÂàó
     */
    updateTextFilter: function (value) {
      this.currentTextFilter = value;
    },

    /**
     * ÂÑ™ÂÖàÂ∫¶„Éï„Ç£„É´„Çø„Éº„ÇíÊõ¥Êñ∞
     * @param {string} priority ÂÑ™ÂÖàÂ∫¶
     */
    updatePriorityFilter: function (priority) {
      this.currentPriorityFilter = priority;
    },

    /**
     * „Åô„Åπ„Å¶„ÅÆ„Éï„Ç£„É´„Çø„Éº„Çí„ÇØ„É™„Ç¢
     */
    clearFilters: function () {
      this.currentTextFilter = '';
      this.currentPriorityFilter = CONSTANTS.PRIORITIES.ALL;
    }
  };

  // =============================================================================
  // UIÁîüÊàê
  // =============================================================================
  const UIGenerator = {
    /**
     * CSS„Çπ„Çø„Ç§„É´„ÇíÁîüÊàê„ÉªÊ≥®ÂÖ•
     */
    injectCSS: function () {
      const existingStyle = document.getElementById('shima-navigator-styles');
      if (existingStyle) {
        existingStyle.remove();
      }

      const style = document.createElement('style');
      style.id = 'shima-navigator-styles';
      style.textContent = `
        #${CONSTANTS.PANEL_ID} .close-button:hover {
          background-color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.TERTIARY} !important;
          opacity: 0.9 !important;
        }

        #${CONSTANTS.PANEL_ID} .category-header:hover {
          background-color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.TERTIARY} !important;
        }

        #${CONSTANTS.PANEL_ID} .nav-link:hover {
          background-color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.TERTIARY} !important;
        }

        #${CONSTANTS.PANEL_ID} button[data-action]:hover:not(:disabled) {
          opacity: 0.9 !important;
          transform: translateY(-1px) !important;
        }

        #${CONSTANTS.PANEL_ID} button[data-action]:active:not(:disabled) {
          transform: translateY(0) !important;
        }

        #${CONSTANTS.PANEL_ID} *::-webkit-scrollbar {
          width: 8px !important;
        }

        #${CONSTANTS.PANEL_ID} *::-webkit-scrollbar-track {
          background: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.TERTIARY} !important;
        }

        #${CONSTANTS.PANEL_ID} *::-webkit-scrollbar-thumb {
          background: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BORDER.DEFAULT} !important;
          border-radius: ${SHAREPOINT_DESIGN_SYSTEM.BORDER_RADIUS.MD} !important;
        }

        #${CONSTANTS.PANEL_ID} *::-webkit-scrollbar-thumb:hover {
          background: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.TEXT.MUTED} !important;
        }
      `;

      document.head.appendChild(style);
    },

    /**
     * „É°„Ç§„É≥HTML„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÁîüÊàê
     * @param {Object} siteInfo „Çµ„Ç§„ÉàÊÉÖÂ†±
     * @param {Array} categories „Ç´„ÉÜ„Ç¥„É™ÈÖçÂàó
     * @returns {string} HTMLÊñáÂ≠óÂàó
     */
    generateHTML: function (siteInfo, categories) {
      const filteredCategories = FilterManager.applyFilters(categories);

      return `
        <div style="${this.getMainContainerStyle()}">
          ${this.generateHeader(siteInfo)}
          ${this.generateFilterArea()}
          ${this.generateContent(filteredCategories)}
        </div>
      `;
    },

    /**
     * „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getMainContainerStyle: function () {
      return [
        'padding: 16px !important',
        'height: 100% !important',
        'display: flex !important',
        'flex-direction: column !important',
        'box-sizing: border-box !important'
      ].join(';');
    },

    /**
     * „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ„ÇíÁîüÊàê
     */
    generateHeader: function (siteInfo) {
      return `
        <div style="${this.getHeaderStyle()}">
          <div>
            <h3 style="${this.getTitleStyle()}">${CONSTANTS.ICONS.NAVIGATOR} SharePoint Navigator</h3>            <div style="${this.getSubtitleStyle()}">${siteInfo.displayName} (${siteInfo.siteType})</div>          </div>
          <button data-action="close" class="close-button" style="${this.getCloseButtonStyle()}"
                  title="„Éë„Éç„É´„ÇíÈñâ„Åò„Çã">‚úï</button>
        </div>
      `;
    },

    /**
     * „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getHeaderStyle: function () {
      return [
        'display: flex !important',
        'justify-content: space-between !important',
        'align-items: center !important',
        `margin-bottom: ${SHAREPOINT_DESIGN_SYSTEM.SPACING.LG} !important`,
        `padding-bottom: ${SHAREPOINT_DESIGN_SYSTEM.SPACING.MD} !important`,
        `border-bottom: 2px solid ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.TERTIARY} !important`,
        'cursor: move !important'
      ].join(';');
    },

    /**
     * „Çø„Ç§„Éà„É´„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getTitleStyle: function () {
      return [
        'margin: 0 !important',
        `color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.PRIMARY} !important`,
        `font-size: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.SIZES.H3} !important`,
        `font-weight: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.WEIGHTS.SEMIBOLD} !important`,
        'cursor: move !important'
      ].join(';');
    },

    /**
     * „Çµ„Éñ„Çø„Ç§„Éà„É´„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getSubtitleStyle: function () {
      return [
        `font-size: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.SIZES.CAPTION} !important`,
        `color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.TEXT.SECONDARY} !important`,
        `margin-top: ${SHAREPOINT_DESIGN_SYSTEM.SPACING.XS} !important`
      ].join(';');
    },

    /**
     * Èñâ„Åò„Çã„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getCloseButtonStyle: function () {
      return [
        `background: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.TERTIARY} !important`,
        'border: none !important',
        `border-radius: ${SHAREPOINT_DESIGN_SYSTEM.BORDER_RADIUS.MD} !important`,
        'width: 28px !important',
        'height: 28px !important',
        'cursor: pointer !important',
        'display: flex !important',
        'align-items: center !important',
        'justify-content: center !important',
        `font-size: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.SIZES.BODY} !important`,
        `transition: all ${SHAREPOINT_DESIGN_SYSTEM.TRANSITIONS.DEFAULT} !important`,
        `color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.TEXT.SECONDARY} !important`
      ].join(';');
    },

    /**
     * „Éï„Ç£„É´„Çø„Éº„Ç®„É™„Ç¢„ÇíÁîüÊàê
     */
    generateFilterArea: function () {
      return `
        <div style="${this.getFilterAreaStyle()}">
          ${this.generateTextFilter()}
          ${this.generatePriorityButtons()}
          ${this.generateClearButton()}
        </div>
      `;
    },

    /**
     * „Éï„Ç£„É´„Çø„Éº„Ç®„É™„Ç¢„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getFilterAreaStyle: function () {
      return [
        'display: flex !important',
        'gap: 8px !important',
        'margin-bottom: 16px !important',
        'align-items: center !important'
      ].join(';');
    },

    /**
     * „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„É´„Çø„Éº„ÇíÁîüÊàê
     */
    generateTextFilter: function () {
      return `
        <input type="text" id="nav-text-filter" placeholder="Ê§úÁ¥¢..." value="${FilterManager.currentTextFilter}"
               style="${this.getTextFilterStyle()}">
      `;
    },

    /**
     * „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„É´„Çø„Éº„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getTextFilterStyle: function () {
      return [
        'flex: 1 !important',
        'padding: 6px 8px !important',
        'border: 1px solid #c8c6c4 !important',
        'border-radius: 4px !important',
        'font-size: 13px !important',
        'font-family: inherit !important'
      ].join(';');
    },

    /**
     * ÂÑ™ÂÖàÂ∫¶„Éú„Çø„É≥„ÇíÁîüÊàê
     */
    generatePriorityButtons: function () {
      const priorities = [
        { key: CONSTANTS.PRIORITIES.ALL, label: 'ÂÖ®„Å¶', color: CONSTANTS.PRIORITY_COLORS.all },
        { key: CONSTANTS.PRIORITIES.HIGH, label: 'È´ò', color: CONSTANTS.PRIORITY_COLORS.high },
        { key: CONSTANTS.PRIORITIES.MEDIUM, label: '‰∏≠', color: CONSTANTS.PRIORITY_COLORS.medium },
        { key: CONSTANTS.PRIORITIES.LOW, label: '‰Ωé', color: CONSTANTS.PRIORITY_COLORS.low }
      ];

      const buttons = priorities.map(priority => {
        const isActive = FilterManager.currentPriorityFilter === priority.key;
        const bgColor = isActive ? priority.color : '#f3f2f1';
        const textColor = isActive ? 'white' : '#323130'; return `
          <button data-action="priority-filter" data-priority="${priority.key}"
                  style="${this.getPriorityButtonStyle(bgColor, textColor, priority.color, isActive)}"
                  title="${priority.label}ÂÑ™ÂÖàÂ∫¶„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞">
            ${priority.label}
          </button>
        `;
      }).join('');

      return `<div style="display: flex !important; gap: 4px !important;">${buttons}</div>`;
    },

    /**
     * ÂÑ™ÂÖàÂ∫¶„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getPriorityButtonStyle: function (bgColor, textColor, borderColor, isActive) {
      return [
        `background: ${bgColor} !important`,
        `color: ${textColor} !important`,
        `border: 1px solid ${borderColor} !important`,
        'border-radius: 4px !important',
        'padding: 4px 8px !important',
        'font-size: 11px !important',
        `font-weight: ${isActive ? '600' : '400'} !important`,
        'cursor: pointer !important',
        'white-space: nowrap !important'
      ].join(';');
    },

    /**
     * „ÇØ„É™„Ç¢„Éú„Çø„É≥„ÇíÁîüÊàê
     */    generateClearButton: function () {
      return `
        <button data-action="clear-filters" style="${this.getClearButtonStyle()}"
                title="ÂÖ®„Å¶„ÅÆ„Éï„Ç£„É´„Çø„Éº„Çí„ÇØ„É™„Ç¢">
          „ÇØ„É™„Ç¢
        </button>
      `;
    },

    /**
     * „ÇØ„É™„Ç¢„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getClearButtonStyle: function () {
      return [
        'background: #f3f2f1 !important',
        'border: 1px solid #c8c6c4 !important',
        'border-radius: 4px !important',
        'padding: 4px 8px !important',
        'font-size: 11px !important',
        'cursor: pointer !important'
      ].join(';');
    },

    /**
     * „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢„ÇíÁîüÊàê
     */
    generateContent: function (filteredCategories) {
      return `
        <div style="${this.getContentAreaStyle()}">
          <div style="${this.getGridStyle()}">
            ${filteredCategories.map((category, index) => this.generateCategory(category, index)).join('')}
          </div>
        </div>
      `;
    },

    /**
     * „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getContentAreaStyle: function () {
      return [
        'flex: 1 !important',
        'overflow-y: auto !important',
        'padding-right: 4px !important'
      ].join(';');
    },

    /**
     * „Ç∞„É™„ÉÉ„Éâ„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getGridStyle: function () {
      return [
        'display: grid !important',
        'grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important',
        'gap: 16px !important'
      ].join(';');
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„ÇíÁîüÊàê
     */
    generateCategory: function (category, categoryIndex) {
      return `
        <div style="${this.getCategoryContainerStyle()}">
          ${this.generateCategoryHeader(category, categoryIndex)}
          ${this.generateCategoryContent(category, categoryIndex)}
        </div>
      `;
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„Ç≥„É≥„ÉÜ„Éä„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getCategoryContainerStyle: function () {
      return [
        'border: 1px solid #edebe9 !important',
        'border-radius: 6px !important',
        'overflow: hidden !important'
      ].join(';');
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„Éò„ÉÉ„ÉÄ„Éº„ÇíÁîüÊàê
     */    generateCategoryHeader: function (category, categoryIndex) {
      const action = category.collapsed ? 'Â±ïÈñã' : 'Êäò„Çä„Åü„Åü„Åø';
      return `
        <div data-action="toggle-category" data-category-index="${categoryIndex}"
             class="category-header" style="${this.getCategoryHeaderStyle()}"
             title="${category.name}„Ç´„ÉÜ„Ç¥„É™„Éº„Çí${action}">
          <span>${category.icon} ${category.name} (${category.links.length})</span>
          <span style="color: #605e5c !important; font-size: 12px !important;" id="arrow-${categoryIndex}">
            ${category.collapsed ? '‚ñ∂' : '‚ñº'}
          </span>
        </div>
      `;
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getCategoryHeaderStyle: function () {
      return [
        'background: #f8f8f8 !important',
        'padding: 8px 12px !important',
        'cursor: pointer !important',
        'border-bottom: 1px solid #edebe9 !important',
        'display: flex !important',
        'justify-content: space-between !important',
        'align-items: center !important',
        'font-weight: 600 !important',
        'font-size: 13px !important'
      ].join(';');
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÁîüÊàê
     */
    generateCategoryContent: function (category, categoryIndex) {
      const linksHtml = category.links.map(link => this.generateLink(link)).join('');

      return `
        <div id="content-${categoryIndex}" style="${this.getCategoryContentStyle(category.collapsed)}">
          ${linksHtml}
        </div>
      `;
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getCategoryContentStyle: function (collapsed) {
      return [
        `display: ${collapsed ? 'none' : 'block'} !important`,
        'padding: 8px !important'
      ].join(';');
    },    /**
     * „É™„É≥„ÇØ„ÇíÁîüÊàê
     */
    generateLink: function (link) {
      const priorityColor = CONSTANTS.PRIORITY_COLORS[link.priority] || '#605e5c';

      // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„Å´Ë™¨Êòé„Å®ÈÅ∑ÁßªÂÖàURL„ÇíÂê´„ÇÅ„Çã
      const tooltipText = `${link.description}\n\nÈÅ∑ÁßªÂÖà: ${link.url}`;

      return `
        <a href="${link.url}" class="nav-link" style="${this.getLinkStyle(priorityColor)}"
           title="${tooltipText}">
          <div style="${this.getLinkTitleStyle()}">${link.icon} ${link.title}</div>
          <div style="${this.getLinkDescriptionStyle()}">${link.description}</div>
        </a>
      `;
    },

    /**
     * „É™„É≥„ÇØ„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getLinkStyle: function (priorityColor) {
      return [
        'display: block !important',
        'padding: 6px 8px !important',
        'margin: 2px 0 !important',
        'text-decoration: none !important',
        'color: #323130 !important',
        'border-radius: 4px !important',
        `border-left: 3px solid ${priorityColor} !important`,
        'background: #fafafa !important'
      ].join(';');
    },

    /**
     * „É™„É≥„ÇØ„Çø„Ç§„Éà„É´„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getLinkTitleStyle: function () {
      return [
        'font-weight: 500 !important',
        'font-size: 12px !important',
        'line-height: 1.3 !important'
      ].join(';');
    },

    /**
     * „É™„É≥„ÇØË™¨Êòé„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getLinkDescriptionStyle: function () {
      return [
        'font-size: 10px !important',
        'color: #605e5c !important',
        'margin-top: 2px !important',
        'line-height: 1.2 !important'
      ].join(';');
    }
  };

  // =============================================================================
  // „Éë„Éç„É´ÁÆ°ÁêÜ
  // =============================================================================
  const PanelManager = {
    panel: null,
    allCategories: [],
    siteInfo: null,
    textFilterHandler: null,

    /**
     * „Éë„Éç„É´„ÇíÂàùÊúüÂåñ
     */
    initialize: function () {
      try {
        // Êó¢Â≠ò„Éë„Éç„É´„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        if (Utils.cleanupExistingPanel()) {
          return;
        }

        // SharePoint„Çµ„Ç§„ÉàÊÉÖÂ†±„ÇíÂèñÂæó
        this.siteInfo = Utils.getSharePointSiteInfo();
        if (!this.siteInfo) {
          alert('„Åì„ÅÆ„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„É¨„ÉÉ„Éà„ÅØSharePoint„Çµ„Ç§„Éà„Åß„ÅÆ„ÅøÂãï‰Ωú„Åó„Åæ„Åô„ÄÇ');
          return;
        }        // „Ç´„ÉÜ„Ç¥„É™„Éá„Éº„Çø„Çí‰ΩúÊàê
        this.allCategories = NavigationData.createCategories(this.siteInfo);

        // CSS„Çπ„Çø„Ç§„É´„ÇíÊ≥®ÂÖ•
        UIGenerator.injectCSS();

        // „Éë„Éç„É´„Çí‰ΩúÊàê
        this.createPanel();
        this.setupGlobalFunctions();

        // „Éë„Éç„É´„ÇíDOM„Å´ËøΩÂä†
        document.body.appendChild(this.panel);

        // DOMËøΩÂä†Âæå„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆöÔºàÁ¢∫ÂÆü„Å´Ë¶ÅÁ¥†„ÅåÂ≠òÂú®„Åô„Çã„Çà„ÅÜ„Å´Ôºâ
        setTimeout(() => {
          this.setupEventListeners();
        }, 0);

        this.setupDragAndResize();

        // „Éë„Éç„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        this.setupOutsideClickHandler();

      } catch (error) {
        console.error('SharePoint Navigator „ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
        alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇË©≥Á¥∞„ÅØ„Ç≥„É≥„ÇΩ„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
      }
    },

    /**
     * „Éë„Éç„É´Ë¶ÅÁ¥†„Çí‰ΩúÊàê
     */
    createPanel: function () {
      this.panel = document.createElement('div');
      this.panel.id = CONSTANTS.PANEL_ID;

      const dimensions = Utils.calculateInitialDimensions();
      this.panel.style.cssText = this.getPanelStyle(dimensions);

      // „É™„Çµ„Ç§„Ç∫„Éè„É≥„Éâ„É´„ÇíËøΩÂä†
      const resizeHandle = this.createResizeHandle();
      this.panel.appendChild(resizeHandle);

      // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË®≠ÂÆö
      this.updateContent();
    },

    /**
     * „Éë„Éç„É´„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
     */
    getPanelStyle: function (dimensions) {
      return [
        'all: initial',
        'position: fixed !important',
        `top: ${dimensions.top}px !important`,
        `left: ${dimensions.left}px !important`,
        `width: ${dimensions.width}px !important`,
        `height: ${dimensions.height}px !important`,
        `min-width: ${CONSTANTS.MIN_WIDTH}px !important`,
        `min-height: ${CONSTANTS.MIN_HEIGHT}px !important`,
        `max-width: ${window.innerWidth - CONSTANTS.MARGIN}px !important`,
        `max-height: ${window.innerHeight - CONSTANTS.MARGIN}px !important`,
        `background: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.BACKGROUND.PRIMARY} !important`,
        `border: 2px solid ${SHAREPOINT_DESIGN_SYSTEM.COLORS.PRIMARY} !important`,
        `border-radius: ${SHAREPOINT_DESIGN_SYSTEM.BORDER_RADIUS.XL} !important`,
        `box-shadow: ${SHAREPOINT_DESIGN_SYSTEM.SHADOWS.PANEL} !important`,
        `z-index: ${CONSTANTS.Z_INDEX} !important`,
        `font-family: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.FONT_FAMILY} !important`,
        `font-size: ${SHAREPOINT_DESIGN_SYSTEM.TYPOGRAPHY.SIZES.BODY} !important`,
        'line-height: 1.4 !important',
        `color: ${SHAREPOINT_DESIGN_SYSTEM.COLORS.TEXT.PRIMARY} !important`,
        'overflow: hidden !important',
        'display: flex !important',
        'flex-direction: column !important'
      ].join(';');
    },

    /**
     * „É™„Çµ„Ç§„Ç∫„Éè„É≥„Éâ„É´„Çí‰ΩúÊàê
     */
    createResizeHandle: function () {
      const resizeHandle = document.createElement('div');
      resizeHandle.className = 'resize-handle';
      resizeHandle.style.cssText = [
        'position: absolute !important',
        'bottom: 0 !important',
        'right: 0 !important',
        'width: 20px !important',
        'height: 20px !important',
        'background: linear-gradient(-45deg, transparent 40%, #c8c6c4 40%, #c8c6c4 60%, transparent 60%) !important',
        'cursor: se-resize !important',
        'z-index: 10 !important'
      ].join(';');

      return resizeHandle;
    },

    /**
     * „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊõ¥Êñ∞
     */
    updateContent: function () {
      this.panel.innerHTML = UIGenerator.generateHTML(this.siteInfo, this.allCategories) +
        this.panel.querySelector('.resize-handle').outerHTML;
    },

    /**
     * „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢„ÅÆ„Åø„ÇíÊõ¥Êñ∞Ôºà„Éï„Ç£„É´„Çø„ÉºÁî®Ôºâ
     */
    updateContentOnly: function () {
      const contentArea = this.panel.querySelector('div[style*="flex: 1"]');
      if (contentArea) {
        const filteredCategories = FilterManager.applyFilters(this.allCategories);
        const gridStyle = UIGenerator.getGridStyle();

        contentArea.innerHTML = `
          <div style="${gridStyle}">
            ${filteredCategories.map((category, index) => UIGenerator.generateCategory(category, index)).join('')}
          </div>
        `;

        // „Ç´„ÉÜ„Ç¥„É™„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂÜçË®≠ÂÆö
        this.setupCategoryEventListeners();
      }
    },

    /**
     * „Ç´„ÉÜ„Ç¥„É™„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆ„Åø„ÇíË®≠ÂÆö
     */
    setupCategoryEventListeners: function () {
      const self = this;

      // „Ç´„ÉÜ„Ç¥„É™„Éà„Ç∞„É´„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
      const toggleElements = this.panel.querySelectorAll('[data-action="toggle-category"]');
      toggleElements.forEach(element => {
        element.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();

          const categoryIndex = parseInt(this.getAttribute('data-category-index'), 10);
          window.shimaNavToggleCategory(categoryIndex);
        });
      });
    },

    /**
     * „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„ÇíË®≠ÂÆö
     */
    setupGlobalFunctions: function () {
      const self = this;

      window.shimaNavUpdateTextFilter = function (value) {
        FilterManager.updateTextFilter(value);
        // „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„É´„Çø„Éº„ÅÆÂ†¥Âêà„ÅØ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ„ÅøÊõ¥Êñ∞
        self.updateContentOnly();
      };

      window.shimaNavUpdatePriorityFilter = function (priority) {
        FilterManager.updatePriorityFilter(priority);
        // ÂÑ™ÂÖàÂ∫¶„Éï„Ç£„É´„Çø„Éº„ÅÆÂ†¥Âêà„ÅØÂÖ®‰Ωì„ÇíÊõ¥Êñ∞Ôºà„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇÇÂ§â„Çè„Çã„Åü„ÇÅÔºâ
        self.updateContent();
        self.setupEventListeners();
      };

      window.shimaNavClearFilters = function () {
        FilterManager.clearFilters();
        // „ÇØ„É™„Ç¢„ÅÆÂ†¥Âêà„ÅØÂÖ®‰Ωì„ÇíÊõ¥Êñ∞Ôºà„Éï„Ç£„É´„Çø„Éº„Ç®„É™„Ç¢„ÇÇ„É™„Çª„ÉÉ„Éà„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Åü„ÇÅÔºâ
        self.updateContent();
        self.setupEventListeners();
      };

      window.shimaNavToggleCategory = function (categoryIndex) {
        const filteredCategories = FilterManager.applyFilters(self.allCategories);
        if (filteredCategories[categoryIndex]) {
          const categoryName = filteredCategories[categoryIndex].name;
          for (let i = 0; i < self.allCategories.length; i++) {
            if (self.allCategories[i].name === categoryName) {
              self.allCategories[i].collapsed = !self.allCategories[i].collapsed;
              break;
            }
          }
          // „Ç´„ÉÜ„Ç¥„É™Â±ïÈñã/Êäò„Çä„Åü„Åü„Åø„ÅÆÂ†¥Âêà„ÅØ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ„ÅøÊõ¥Êñ∞
          self.updateContentOnly();
        }
      }; window.shimaNavClosePanel = function () {
        // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        if (self.outsideClickHandler) {
          document.removeEventListener('click', self.outsideClickHandler, false);
          self.outsideClickHandler = null;
        }        // „Éë„Éç„É´ÂÜÖ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        if (self.panelClickHandler && self.panel) {
          self.panel.removeEventListener('click', self.panelClickHandler, false);
          self.panelClickHandler = null;
        }

        // „Éë„Éç„É´„ÇíÂâäÈô§
        if (self.panel && self.panel.parentNode) {
          self.panel.remove();
        }        // Ê≥®ÂÖ•„Åó„ÅüCSS„ÇíÂâäÈô§
        const styleElement = document.getElementById('shima-navigator-styles');
        if (styleElement) {
          styleElement.remove();
        }

        // „Ç≥„É≥„ÇΩ„Éº„É´Ë≠¶ÂëäÊäëÂà∂„ÇíÂÖÉ„Å´Êàª„ÅôÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶Ôºâ
        if (window.originalConsoleWarn) {
          console.warn = window.originalConsoleWarn;
          delete window.originalConsoleWarn;
        }

        // „Ç∞„É≠„Éº„ÉêÈñ¢Êï∞„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        Utils.cleanupGlobalFunctions();
      };
    },

    /**
     * „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
     */
    setupEventListeners: function () {
      const self = this;

      // „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„É´„Çø„Éº„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
      const textInput = document.getElementById('nav-text-filter');
      if (textInput) {
        // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        textInput.removeEventListener('input', this.textFilterHandler);

        // Êñ∞„Åó„ÅÑ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
        this.textFilterHandler = function (e) {
          // „Éï„Ç©„Éº„Ç´„Çπ„ÇíÁ∂≠ÊåÅ„Åô„Çã„Åü„ÇÅ„ÄÅ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„Çí‰øùÂ≠ò
          const cursorPosition = this.selectionStart;

          // „Éï„Ç£„É´„Çø„Éº„ÇíÊõ¥Êñ∞„Åó„ÄÅ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ„Åø„ÇíÊõ¥Êñ∞
          FilterManager.updateTextFilter(this.value);
          self.updateContentOnly();

          // „Éï„Ç©„Éº„Ç´„Çπ„Å®„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÇíÂæ©ÂÖÉ
          setTimeout(() => {
            const newInput = document.getElementById('nav-text-filter');
            if (newInput) {
              newInput.focus();
              newInput.setSelectionRange(cursorPosition, cursorPosition);
            }
          }, 0);
        };

        textInput.addEventListener('input', this.textFilterHandler);
      }

      // data-actionÂ±ûÊÄß„ÇíÊåÅ„Å§Ë¶ÅÁ¥†„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
      const actionElements = this.panel.querySelectorAll('[data-action]');
      console.log('Elements with data-action:', actionElements.length);

      actionElements.forEach(element => {
        element.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();

          const action = this.getAttribute('data-action');
          console.log('Action clicked:', action);

          switch (action) {
            case 'close':
              window.shimaNavClosePanel();
              break;

            case 'priority-filter':
              const priority = this.getAttribute('data-priority');
              window.shimaNavUpdatePriorityFilter(priority);
              break;

            case 'clear-filters':
              window.shimaNavClearFilters();
              break;

            case 'toggle-category':
              const categoryIndex = parseInt(this.getAttribute('data-category-index'), 10);
              window.shimaNavToggleCategory(categoryIndex);
              break;

            default:
              console.log('Unknown action:', action);
          }
        });
      });

      // ÊÆã„Å£„Å¶„ÅÑ„ÇãonclickÂ±ûÊÄß„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
      const onclickElements = this.panel.querySelectorAll('[onclick]');
      if (onclickElements.length > 0) {
        console.warn('Still have onclick elements:', onclickElements.length);
      }
    },

    /**
     * „Éâ„É©„ÉÉ„Ç∞&„É™„Çµ„Ç§„Ç∫Ê©üËÉΩ„ÇíË®≠ÂÆö
     */
    setupDragAndResize: function () {
      this.dragHandler = new DragResizeHandler(this.panel);
      this.dragHandler.initialize();
    },

    /**
     * „Éë„Éç„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº„ÇíË®≠ÂÆö
     */
    setupOutsideClickHandler: function () {
      const self = this;

      // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
      if (this.outsideClickHandler) {
        document.removeEventListener('click', this.outsideClickHandler);
      }

      if (this.panelClickHandler) {
        this.panel.removeEventListener('click', this.panelClickHandler);
      }

      // „Éë„Éç„É´ÂÜÖ„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº - „Éë„Éç„É´ÂÜÖ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØ„Ç§„Éô„É≥„Éà‰ºùÊí≠„ÇíÂÅúÊ≠¢
      this.panelClickHandler = function (e) {
        console.log('Panel internal click detected - preventing propagation');
        e.stopPropagation(); // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº„Å∏„ÅÆ‰ºùÊí≠„ÇíÈò≤„Åê
      };

      // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº - „Ç∑„É≥„Éó„É´„Å™Ë®≠Ë®à
      this.outsideClickHandler = function (e) {
        console.log('Document click detected - checking if should close panel');

        // „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
        if (self.dragHandler && (self.dragHandler.isDragging || self.dragHandler.isResizing)) {
          console.log('Drag/resize in progress - ignoring click');
          return;
        }

        // „Åì„Åì„Å´Âà∞ÈÅî„Åó„Åü„Å®„ÅÑ„ÅÜ„Åì„Å®„ÅØ„ÄÅ„Éë„Éç„É´Â§ñ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„Å®„ÅÑ„ÅÜ„Åì„Å®
        // Ôºà„Éë„Éç„É´ÂÜÖ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÅØ stopPropagation() „ÅßÈòªÊ≠¢„Åï„Çå„Çã„Åü„ÇÅÔºâ
        console.log('Closing panel due to outside click');
        window.shimaNavClosePanel();
      };

      // „Éë„Éç„É´ÂÜÖ„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº„ÇíËøΩÂä†Ôºà„Ç§„Éô„É≥„Éà‰ºùÊí≠„ÇíÂÅúÊ≠¢„Åô„Çã„Åü„ÇÅÔºâ
      this.panel.addEventListener('click', this.panelClickHandler, false);

      // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº„ÇíËøΩÂä†ÔºàÂ∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„ÇãÔºâ
      setTimeout(function () {
        document.addEventListener('click', self.outsideClickHandler, false);
      }, 100);
    }
  };
  // =============================================================================
  // „Éâ„É©„ÉÉ„Ç∞&„É™„Çµ„Ç§„Ç∫„Éè„É≥„Éâ„É©„Éº
  // =============================================================================
  function DragResizeHandler(panel) {
    this.panel = panel;
    this.isDragging = false;
    this.isResizing = false;
    this.currentX = 0;
    this.currentY = 0;
    this.initialX = 0;
    this.initialY = 0;
    this.xOffset = 0;
    this.yOffset = 0;
    this.startWidth = 0;
    this.startHeight = 0;
    this.startX = 0;
    this.startY = 0;
    this.lastDragEndTime = 0;
  }

  DragResizeHandler.prototype = {
    /**
     * „Éâ„É©„ÉÉ„Ç∞&„É™„Çµ„Ç§„Ç∫„ÇíÂàùÊúüÂåñ
     */
    initialize: function () {
      this.panel.addEventListener('mousedown', this.handleMouseDown.bind(this), false);
      document.addEventListener('mouseup', this.handleMouseUp.bind(this), false);
      document.addEventListener('mousemove', this.handleMouseMove.bind(this), false);
    },

    /**
     * „Éû„Ç¶„Çπ„ÉÄ„Ç¶„É≥„Éè„É≥„Éâ„É©„Éº
     */
    handleMouseDown: function (e) {
      const resizeHandle = this.panel.querySelector('.resize-handle');

      if (e.target === resizeHandle) {
        this.startResize(e);
      } else if (this.isInDragArea(e)) {
        this.startDrag(e);
      }
    },

    /**
     * „É™„Çµ„Ç§„Ç∫ÈñãÂßã
     */
    startResize: function (e) {
      this.isResizing = true;
      this.startX = e.clientX;
      this.startY = e.clientY;
      this.startWidth = parseInt(getComputedStyle(this.panel).width, 10);
      this.startHeight = parseInt(getComputedStyle(this.panel).height, 10);
      e.preventDefault();
    },

    /**
     * „Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
     */
    startDrag: function (e) {
      if (!e.target.closest('button') && !e.target.closest('input') && !e.target.closest('select')) {
        this.initialX = e.clientX - this.xOffset;
        this.initialY = e.clientY - this.yOffset;
        this.isDragging = true;
        this.panel.style.cursor = 'move';
        e.preventDefault();
      }
    },

    /**
     * „Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Ç®„É™„Ç¢„Åã„ÉÅ„Çß„ÉÉ„ÇØ
     */
    isInDragArea: function (e) {
      const rect = this.panel.getBoundingClientRect();
      const isInHeaderArea = (e.clientY - rect.top) < 60;
      const isHeaderElement = e.target.tagName === 'H3' ||
        e.target.closest('h3') ||
        (e.target.closest('div') && e.target.closest('div').style.borderBottom);

      return isInHeaderArea || isHeaderElement;
    },

    /**
     * „Éû„Ç¶„ÇπÁßªÂãï„Éè„É≥„Éâ„É©„Éº
     */
    handleMouseMove: function (e) {
      if (this.isDragging) {
        this.handleDrag(e);
      } else if (this.isResizing) {
        this.handleResize(e);
      }
    },

    /**
     * „Éâ„É©„ÉÉ„Ç∞Âá¶ÁêÜ
     */
    handleDrag: function (e) {
      e.preventDefault();
      this.currentX = e.clientX - this.initialX;
      this.currentY = e.clientY - this.initialY;
      this.xOffset = this.currentX;
      this.yOffset = this.currentY;

      const newLeft = Math.max(0, Math.min(this.currentX, window.innerWidth - this.panel.offsetWidth));
      const newTop = Math.max(0, Math.min(this.currentY, window.innerHeight - this.panel.offsetHeight));

      this.panel.style.left = newLeft + 'px';
      this.panel.style.top = newTop + 'px';
    },

    /**
     * „É™„Çµ„Ç§„Ç∫Âá¶ÁêÜ
     */
    handleResize: function (e) {
      e.preventDefault();
      const newWidth = this.startWidth + e.clientX - this.startX;
      const newHeight = this.startHeight + e.clientY - this.startY;

      const maxWidth = window.innerWidth - parseInt(this.panel.style.left, 10) - CONSTANTS.MARGIN;
      const maxHeight = window.innerHeight - parseInt(this.panel.style.top, 10) - CONSTANTS.MARGIN;

      const finalWidth = Math.max(CONSTANTS.MIN_WIDTH, Math.min(newWidth, maxWidth));
      const finalHeight = Math.max(CONSTANTS.MIN_HEIGHT, Math.min(newHeight, maxHeight));

      this.panel.style.width = finalWidth + 'px';
      this.panel.style.height = finalHeight + 'px';
    },

    /**
     * „Éû„Ç¶„Çπ„Ç¢„ÉÉ„Éó„Éè„É≥„Éâ„É©„Éº
     */
    handleMouseUp: function (e) {
      if (this.isDragging) {
        this.initialX = this.currentX;
        this.initialY = this.currentY;
        this.isDragging = false;
        this.panel.style.cursor = '';
        this.lastDragEndTime = Date.now();
        e.preventDefault();
        e.stopPropagation();
      }
      if (this.isResizing) {
        this.isResizing = false;
        this.lastDragEndTime = Date.now();
        e.preventDefault();
        e.stopPropagation();
      }
    }
  };

  // =============================================================================
  // „É°„Ç§„É≥ÂÆüË°å
  // =============================================================================
  PanelManager.initialize();

})();
