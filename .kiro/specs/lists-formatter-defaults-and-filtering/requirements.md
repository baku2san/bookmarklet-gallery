# 要件定義書

## 概要

この機能は、Microsoft Lists Column Formatter ブックマークレットに、列タイプ別のデフォルト書式テンプレートの追加と、書式選択インターフェースでのタイプベースフィルタリングの実装により機能を強化します。目標は、すぐに使える書式オプションを提供し、特定の列タイプに関連する書式を見つけやすくすることで、ユーザーエクスペリエンスを向上させることです。

## 要件

### 要件 1

**ユーザーストーリー:** Lists ユーザーとして、一般的な列タイプ用の事前構築されたデフォルト書式テンプレートにアクセスしたい。そうすることで、ゼロから作成することなく、プロフェッショナルな見た目の書式を素早く適用できる。

#### 受け入れ基準

1. ユーザーが書式選択インターフェースを開いたとき、システムは列タイプ別に整理されたデフォルト書式テンプレートを表示する
2. ユーザーが列タイプを選択したとき、システムはそのタイプに対して約 2 つのデフォルト書式オプションを表示する
3. ユーザーがデフォルト書式を適用したとき、システムは対象列のプロパティに合わせて書式 JSON をカスタマイズする
4. 列タイプに適切なデフォルト書式がない場合、システムはデフォルトが利用できないことを示すメッセージを表示する
5. ユーザーがデフォルト書式をプレビューしたとき、システムは列タイプに適したサンプルデータを使用してリアルなプレビューを表示する

### 要件 2

**ユーザーストーリー:** Lists 管理者として、異なるデータタイプのベストプラクティスを示すデフォルト書式テンプレートが欲しい。そうすることで、ユーザーが効果的な書式設定技術を学べる。

#### 受け入れ基準

1. 数値列にデフォルト書式が提供されるとき、システムはパーセンテージベースの色分けを使用する書式を少なくとも 1 つ含める
2. ユーザー/担当者列にデフォルト書式が提供されるとき、システムはユーザー画像と名前を一緒に表示する書式を少なくとも 1 つ含める
3. 日時列にデフォルト書式が提供されるとき、システムは絶対時間と相対時間表示の両方の書式を含める
4. 選択肢列にデフォルト書式が提供されるとき、システムはピルやアイコンなどの視覚的インジケーターを含む書式を含める
5. はい/いいえ列にデフォルト書式が提供されるとき、システムはアイコンベースの表現を含める

### 要件 3

**ユーザーストーリー:** Lists ユーザーとして、保存済みおよびデフォルト書式を列タイプでフィルタリングしたい。そうすることで、対象列と互換性のある書式を素早く見つけられる。

#### 受け入れ基準

1. ユーザーが書式選択インターフェースを開いたとき、システムは利用可能なすべての列タイプを含むタイプフィルタードロップダウンを表示する
2. ユーザーが列タイプフィルターを選択したとき、システムはそのタイプと互換性のある書式のみを表示する
3. ユーザーが「すべてのタイプ」フィルターを選択したとき、システムは利用可能なすべての書式を表示する
4. ユーザーがタイプフィルターを適用したとき、システムは手動で変更されるまでフィルター選択を維持する
5. 選択されたタイプフィルターに一致する書式がないとき、システムは適切なメッセージを表示する

### 要件 4

**ユーザーストーリー:** Lists ユーザーとして、書式選択インターフェースに互換性インジケーターを表示したい。そうすることで、対象列で最も適切に動作する書式を理解できる。

#### 受け入れ基準

1. 選択インターフェースで書式が表示されるとき、システムは各書式の互換性インジケーターを表示する
2. 書式が対象列と完全に互換性があるとき、システムは緑色の互換性インジケーターを表示する
3. 書式に潜在的な互換性問題があるとき、システムは説明付きの黄色の警告インジケーターを表示する
4. 書式が対象列と互換性がないとき、システムは赤色の非互換性インジケーターを表示する
5. ユーザーが互換性インジケーターにホバーしたとき、システムは詳細な互換性情報を表示する

### 要件 5

**ユーザーストーリー:** Lists ユーザーとして、デフォルト書式が特定の列に自動的にカスタマイズされることを望む。そうすることで、手動での JSON 編集なしに正しく動作する。

#### 受け入れ基準

1. ユーザーがデフォルト書式を列に適用したとき、システムは汎用フィールド参照を実際の列の内部名に自動的に置き換える
2. ユーザーが複数値列に書式を適用したとき、システムは適切な配列処理関数を自動的に追加する
3. ユーザーがプロパティ参照を含む書式を適用したとき、システムは対象列がそれらのプロパティをサポートしていることを検証する
4. 自動カスタマイズが実行できないとき、システムはユーザーに警告し、手動編集オプションを提供する
5. カスタマイズが成功したとき、システムは適用前にカスタマイズされた書式のプレビューを表示する

### 要件 6

**ユーザーストーリー:** ブックマークレットを保守する開発者として、デフォルト書式が簡単に保守・拡張可能であることを望む。そうすることで、大きなコード変更なしに新しい書式を追加できる。

#### 受け入れ基準

1. 新しいデフォルト書式が追加されるとき、システムは中央集約された設定構造を通じてそれらを追加することをサポートする
2. デフォルト書式が定義されるとき、システムは名前、説明、対象列タイプ、プレビューデータなどのメタデータを含める
3. システムがデフォルト書式を読み込むとき、システムは書式 JSON 構造とメタデータを検証する
4. デフォルト書式が検証に失敗したとき、システムはエラーをログに記録し、他の書式の読み込みを続行する
5. デフォルト書式が更新されるとき、システムは既存の保存済み書式との後方互換性を維持する
